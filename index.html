<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<title>J√§√§tel√∂kioski</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}
.box {
  background: white;
  padding: 20px;
  max-width: 800px;
  margin: auto;
}
.info {
  background: #fef5e7;
  padding: 10px;
  margin: 10px 0;
}
.calc {
  background: #e8f8f5;
  padding: 10px;
  margin: 10px 0;
}
button {
  padding: 10px 20px;
  font-size: 16px;
}
.hidden {
  display: none;
}
</style>
</head>

<body>
<div class="box">

<h1>üç¶ J√§√§tel√∂kioski</h1>

<div id="gameArea">

<h3>Viikko <span id="weekNumber">1</span> / 12</h3>

<h3>Sijainti</h3>
<select id="location">
  <option value="1.2">Uimaranta</option>
  <option value="1.0">Puisto</option>
  <option value="0.9">Kauppakeskus</option>
</select>

<div class="info">
Uimaranta = suuri myyntipotentiaali, mutta s√§√§herkk√§.<br>
Puisto = tasainen ja ennustettava.<br>
Kauppakeskus = vakaa mutta matalampi huippumyynti.
</div>

<h3>Hinnoittelu ja tilaus</h3>

<label>J√§√§tel√∂n hinta (‚Ç¨ / annos)</label><br>
<input type="number" id="price" value="3.5" step="0.1"><br><br>

<label>Tilattavat j√§√§tel√∂paketit (1 paketti = 50 annosta)</label><br>
<input type="number" id="packages" value="8" min="0"><br><br>

<div class="calc" id="calculator"></div>

<button id="playButton">Pelaa viikko</button>

<hr>
<div id="result"></div>

</div>

<div id="reportArea" class="hidden"></div>

</div>

<script>
/* ---- VAKIOT ---- */
const fixedCost = 500;
const packagePrice = 30;
const portionsPerPackage = 50;
const totalWeeks = 12;

/* ---- TILAMUUTTUJAT ---- */
let week = 1;
let totalRevenue = 0;
let totalCosts = 0;
let goodWeeks = 0;
let badWeeks = 0;

/* ---- ELEMENTIT ---- */
const priceInput = document.getElementById("price");
const packagesInput = document.getElementById("packages");
const calculator = document.getElementById("calculator");
const result = document.getElementById("result");
const weekNumber = document.getElementById("weekNumber");
const reportArea = document.getElementById("reportArea");
const gameArea = document.getElementById("gameArea");
const playButton = document.getElementById("playButton");

/* ---- KANNATTAVUUSLASKURI ---- */
function updateCalculator() {
  const price = Number(priceInput.value);
  const variableCost = packagePrice / portionsPerPackage;
  const contribution = price - variableCost;

  if (contribution <= 0) {
    calculator.innerHTML =
      "‚ö†Ô∏è T√§ll√§ hinnalla et saa katettua edes muuttuvia kustannuksia.";
    return;
  }

  const neededPortions = Math.ceil(fixedCost / contribution);
  const neededPackages = Math.ceil(neededPortions / portionsPerPackage);

  calculator.innerHTML =
    `<strong>Kriittinen piste:</strong><br>
     ${neededPortions} annosta / viikko<br>
     (${neededPackages} pakettia)`;
}

/* ---- VIIKON PELAAMINEN ---- */
function playWeek() {
  const price = Number(priceInput.value);
  const orderedPackages = Number(packagesInput.value);
  const locationFactor = Number(document.getElementById("location").value);

  const weather = Math.floor(Math.random() * 11); // 0‚Äì10
  const maxSales = orderedPackages * portionsPerPackage;

  const baseDemand =
    600 * (weather / 10) * locationFactor * (5 / price);

  const sales = Math.min(maxSales, Math.round(baseDemand));

  const revenue = sales * price;
  const costs = orderedPackages * packagePrice + fixedCost;
  const profit = revenue - costs;

  totalRevenue += revenue;
  totalCosts += costs;

  if (profit >= 0) goodWeeks++;
  else badWeeks++;

  result.innerHTML =
    `<strong>S√§√§:</strong> ${weather}/10<br>
     <strong>Myynti:</strong> ${sales} annosta<br>
     <strong>Viikon tulos:</strong> ${profit.toFixed(0)} ‚Ç¨`;

  week++;
  weekNumber.textContent = week;

  if (week > totalWeeks) {
    endGame();
  }
}

/* ---- LOPPURAPORTTI ---- */
function endGame() {
  gameArea.classList.add("hidden");

  const finalProfit = totalRevenue - totalCosts;

  reportArea.classList.remove("hidden");
  reportArea.innerHTML = `
    <h2>üìÑ Loppuraportti</h2>
    <p><strong>Kes√§ty√∂jakso:</strong> 12 viikkoa</p>
    <p><strong>Liikevaihto:</strong> ${totalRevenue.toFixed(0)} ‚Ç¨</p>
    <p><strong>Kustannukset:</strong> ${totalCosts.toFixed(0)} ‚Ç¨</p>
    <p><strong>Tulos ennen veroja:</strong> ${finalProfit.toFixed(0)} ‚Ç¨</p>
    <p><strong>Hyvi√§ viikkoja:</strong> ${goodWeeks}</p>
    <p><strong>Huonoja viikkoja:</strong> ${badWeeks}</p>
    <p><strong>Kokonaisarvio:</strong><br>
      ${finalProfit > 0
        ? "Kes√§ oli kannattava. Hinnoittelu ja tilaukset osuivat hyvin."
        : "Kes√§ oli haastava. Riskit olivat suuria tai kysynt√§ j√§i heikoksi."}
    </p>
  `;
}

/* ---- TAPAHTUMAT ---- */
priceInput.addEventListener("input", updateCalculator);
packagesInput.addEventListener("input", updateCalculator);
playButton.addEventListener("click", playWeek);

/* ---- ALUSTUS ---- */
updateCalculator();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<title>J√§√§tel√∂kioski</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}
.box {
  background: white;
  padding: 20px;
  max-width: 900px;
  margin: auto;
}
.info {
  background: #fef5e7;
  padding: 10px;
  margin: 10px 0;
}
.calc {
  background: #e8f8f5;
  padding: 10px;
  margin: 10px 0;
}
button {
  padding: 10px 20px;
  font-size: 16px;
}
.hidden {
  display: none;
}
</style>
</head>

<body>
<div class="box">

<h1>üç¶ J√§√§tel√∂kioski</h1>

<div id="gameArea">

<h3>Viikko <span id="weekNumber">1</span> / 12</h3>

<h3>Sijainti</h3>
<select id="location">
  <option value="beach">Uimaranta</option>
  <option value="park">Puisto</option>
  <option value="mall">Kauppakeskus</option>
</select>

<div class="info">
<strong>Uimaranta:</strong> Eritt√§in s√§√§herkk√§, huippumyynti helteell√§.<br>
<strong>Puisto:</strong> Tasainen ja ennustettava.<br>
<strong>Kauppakeskus:</strong> Vakaa, hy√∂tyy huonosta s√§√§st√§.
</div>

<h3>Hinnoittelu ja tilaus</h3>

<label>J√§√§tel√∂n hinta (‚Ç¨ / annos)</label><br>
<input type="number" id="price" value="3.5" step="0.1"><br><br>

<label>Tilattavat j√§√§tel√∂paketit (1 paketti = 50 annosta)</label><br>
<input type="number" id="packages" value="8" min="0"><br><br>

<div class="calc" id="calculator"></div>
<div class="info" id="forecast"></div>

<button id="playButton">Pelaa viikko</button>

<hr>
<div id="result"></div>

</div>

<div id="reportArea" class="hidden"></div>

</div>

<script>
/* ---- VAKIOT ---- */
const fixedCost = 500;
const packagePrice = 30;
const portionsPerPackage = 50;
const totalWeeks = 12;

/* ---- TILA ---- */
let week = 1;
let totalRevenue = 0;
let totalCosts = 0;
let goodWeeks = 0;
let badWeeks = 0;
let forecastWeather = 0;

/* ---- ELEMENTIT ---- */
const priceInput = document.getElementById("price");
const packagesInput = document.getElementById("packages");
const calculator = document.getElementById("calculator");
const result = document.getElementById("result");
const weekNumber = document.getElementById("weekNumber");
const reportArea = document.getElementById("reportArea");
const gameArea = document.getElementById("gameArea");
const playButton = document.getElementById("playButton");
const forecastBox = document.getElementById("forecast");
const locationSelect = document.getElementById("location");

/* ---- S√Ñ√Ñ ---- */
function weatherDescription(v) {
  if (v <= 1) return "Kylm√§√§ ja rankkasadetta";
  if (v <= 3) return "Hyvin sateista";
  if (v <= 5) return "Vaihtelevaa";
  if (v <= 7) return "L√§mmin kes√§s√§√§";
  if (v <= 9) return "Eritt√§in l√§mmin kes√§s√§√§";
  return "Helle";
}

/* ---- S√Ñ√ÑKERROIN SIJAINNIN MUKAAN ---- */
function weatherFactor(weather, location) {
  if (location === "beach") return Math.max(0.2, weather / 10);
  if (location === "park") return 0.6 + weather / 20;
  if (location === "mall") return 1.1 - weather / 25;
  return 1;
}

/* ---- KOKONAISKYSYNT√Ñ ---- */
function totalDemand(weather) {
  // koko kaupungin viikottainen maksimikysynt√§
  return Math.round(2500 * (0.4 + weather / 10));
}

/* ---- KILPAILIJAT ---- */
function competitors(weather) {
  return [
    {
      name: "Kilpailija A",
      price: 3 + Math.random(),
      demand: Math.round(700 * (weather / 10))
    },
    {
      name: "Kilpailija B",
      price: 3.5 + Math.random(),
      demand: Math.round(600 * (weather / 10))
    }
  ];
}

/* ---- LASKURI + ENNUSTE ---- */
function updateCalculator() {
  const price = Number(priceInput.value);
  const variableCost = packagePrice / portionsPerPackage;
  const contribution = price - variableCost;

  if (contribution <= 0) {
    calculator.innerHTML =
      "‚ö†Ô∏è T√§ll√§ hinnalla et saa katettua edes muuttuvia kustannuksia.";
  } else {
    const needed = Math.ceil(fixedCost / contribution);
    calculator.innerHTML =
      `<strong>Kriittinen piste:</strong><br>
       ${needed} annosta / viikko`;
  }

  forecastWeather = Math.floor(Math.random() * 11);
  const err = Math.floor(Math.random() * 5) - 2;
  let shown = Math.max(0, Math.min(10, forecastWeather + err));

  forecastBox.innerHTML =
    `<strong>S√§√§ennuste:</strong> ${shown}/10<br>
     (${weatherDescription(shown)})`;
}

/* ---- VIIKKO ---- */
function playWeek() {
  const price = Number(priceInput.value);
  const orderedPackages = Number(packagesInput.value);
  const location = locationSelect.value;

  const weather = forecastWeather;
  const cityDemand = totalDemand(weather);
  const rivals = competitors(weather);

  let remainingDemand = cityDemand;
  rivals.forEach(r => remainingDemand -= r.demand);
  remainingDemand = Math.max(0, remainingDemand);

  const factor = weatherFactor(weather, location);
  const potentialSales = Math.round(remainingDemand * factor * (5 / price));
  const maxSales = orderedPackages * portionsPerPackage;
  const sales = Math.min(maxSales, potentialSales);

  const revenue = sales * price;
  const costs = orderedPackages * packagePrice + fixedCost;
  const profit = revenue - costs;

  totalRevenue += revenue;
  totalCosts += costs;
  profit >= 0 ? goodWeeks++ : badWeeks++;

  result.innerHTML =
    `<strong>Toteutunut s√§√§:</strong> ${weather}/10 (${weatherDescription(weather)})<br>
     <strong>Kokonaiskysynt√§ kaupungissa:</strong> ${cityDemand} annosta<br>
     <strong>Kilpailijoiden myynti:</strong><br>
     ${rivals.map(r => `${r.name}: ${r.demand} annosta (hinta ${r.price.toFixed(2)} ‚Ç¨)`).join("<br>")}<br><br>
     <strong>Sinun myyntisi:</strong> ${sales} annosta<br>
     <strong>Viikon tulos:</strong> ${profit.toFixed(0)} ‚Ç¨`;

  week++;
  weekNumber.textContent = week;

  if (week > totalWeeks) endGame();
  else updateCalculator();
}

/* ---- LOPPURAPORTTI ---- */
function endGame() {
  gameArea.classList.add("hidden");
  const finalProfit = totalRevenue - totalCosts;

  reportArea.classList.remove("hidden");
  reportArea.innerHTML = `
    <h2>üìÑ Loppuraportti</h2>
    <p><strong>Liikevaihto:</strong> ${totalRevenue.toFixed(0)} ‚Ç¨</p>
    <p><strong>Kustannukset:</strong> ${totalCosts.toFixed(0)} ‚Ç¨</p>
    <p><strong>Tulos ennen veroja:</strong> ${finalProfit.toFixed(0)} ‚Ç¨</p>
    <p><strong>Hyvi√§ viikkoja:</strong> ${goodWeeks}</p>
    <p><strong>Huonoja viikkoja:</strong> ${badWeeks}</p>
    <p><strong>Arvio:</strong><br>
      ${finalProfit > 0
        ? "Menestyit kilpailussa ja hy√∂dynsit markkinatilanteen."
        : "Kilpailu ja kysynt√§ rajoittivat kannattavuutta."}
    </p>
  `;
}

/* ---- EVENTIT ---- */
priceInput.addEventListener("input", updateCalculator);
packagesInput.addEventListener("input", updateCalculator);
locationSelect.addEventListener("change", updateCalculator);
playButton.addEventListener("click", playWeek);

/* ---- ALUSTUS ---- */
updateCalculator();
</script>

</body>
</html>

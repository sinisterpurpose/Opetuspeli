<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<title>J√§√§tel√∂kioski</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f8fb;
  padding: 20px;
  max-width: 900px;
  margin: auto;
}

h1, h2 {
  color: #2c3e50;
}

.box {
  background: white;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 8px;
  box-shadow: 0 0 5px rgba(0,0,0,0.1);
}

label {
  display: block;
  margin-top: 10px;
}

button {
  margin-top: 15px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

.progress {
  background: #ddd;
  border-radius: 10px;
  overflow: hidden;
  height: 20px;
  margin-top: 5px;
}

.progress-bar {
  height: 100%;
  background: green;
  width: 80%;
}
</style>
</head>

<body>

<h1>üç¶ J√§√§tel√∂kioski</h1>

<div class="box">
<h2>Viikko {{viikko}}</h2>

<p><b>S√§√§:</b> <span id="weatherText"></span> (ennuste: <span id="forecastText"></span>)</p>

<p><b>Jaksaminen:</b> <span id="energyValue"></span>/100</p>
<div class="progress">
  <div class="progress-bar" id="energyBar"></div>
</div>

</div>

<div class="box">
<h2>P√§√§t√∂kset</h2>

<label>
Hinta (‚Ç¨ / annos):
<input type="number" id="price" value="3.5" step="0.1">
</label>

<label>
Tilattavat pakkaukset (5 l):
<input type="number" id="packages" value="8">
</label>

<button onclick="playWeek()">Pelaa viikko</button>
</div>

<div class="box">
<h2>Viikon tulos</h2>
<div id="result"></div>
</div>

<script>
let week = 1;
let cash = -500;
let energy = 80;

const portionsPerPackage = 50;
const packagePrice = 30;
const fixedCost = 500;

const weatherTexts = [
  "Kylm√§√§ ja rankkasadetta",
  "Hyvin sateista",
  "Vaihtelevaa",
  "L√§mmin kes√§s√§√§",
  "Eritt√§in l√§mmin kes√§s√§√§",
  "Helle"
];

function updateEnergyBar() {
  const bar = document.getElementById("energyBar");
  bar.style.width = energy + "%";

  if (energy > 60) bar.style.background = "green";
  else if (energy > 30) bar.style.background = "orange";
  else bar.style.background = "red";

  document.getElementById("energyValue").innerText = energy;
}

function playWeek() {
  const price = Number(document.getElementById("price").value);
  const orderedPackages = Number(document.getElementById("packages").value);

  // S√§√§
  const forecast = Math.floor(Math.random() * 6);
  let weather = forecast + Math.floor(Math.random() * 5 - 2);
  weather = Math.max(0, Math.min(5, weather));

  document.getElementById("weatherText").innerText = weatherTexts[weather];
  document.getElementById("forecastText").innerText = weatherTexts[forecast];

  // Kysynt√§
  let baseDemand = 200 + weather * 120;
  baseDemand *= (4 / price);

  // Jaksamisen vaikutus
  let energyFactor = 1;
  if (energy < 60) energyFactor = 0.9;
  if (energy < 40) energyFactor = 0.75;
  if (energy < 20) energyFactor = 0.5;

  baseDemand *= energyFactor;

  const maxSales = orderedPackages * portionsPerPackage;
  const sold = Math.min(Math.floor(baseDemand), maxSales);

  const revenue = sold * price;
  const costs = orderedPackages * packagePrice + fixedCost;
  const profit = revenue - costs;

  cash += profit;

  // Jaksamisen muutos
  let energyLoss = 5;
  if (sold > 300) energyLoss += 5;
  if (weather <= 1) energyLoss += 5;
  if (sold > 500) energyLoss += 5;

  energy -= energyLoss;
  energy = Math.max(0, energy);

  updateEnergyBar();

  document.getElementById("result").innerHTML = `
    <p>Myyty: <b>${sold}</b> annosta</p>
    <p>Tulot: ${revenue.toFixed(0)} ‚Ç¨</p>
    <p>Kulut: ${costs.toFixed(0)} ‚Ç¨</p>
    <p><b>Viikon tulos: ${profit.toFixed(0)} ‚Ç¨</b></p>
    <p>Kassa yhteens√§: ${cash.toFixed(0)} ‚Ç¨</p>
  `;

  week++;
}

updateEnergyBar();
</script>

</body>
</html>
